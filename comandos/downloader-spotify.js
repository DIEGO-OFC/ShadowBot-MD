import fetch from 'node-fetch'

let handler = async (m, { conn, text, usedPrefix, command }) => {
	if (!text) throw `*Usage : ${usedPrefix + command} url*\n\nExample: ${usedPrefix + command} https://open.spotify.com/track/0ZEYRVISCaqz5yamWZWzaA\n\n*Tips :* Untuk mencari link spotify, bisa juga dengan command *${usedPrefix}spotsearch*`
    if (!(text.includes('http://') || text.includes('https://'))) throw `url invalid, please input a valid url. Try with add http:// or https://`
	let res = await fetch(`https://api.lolhuman.xyz/api/spotify?apikey=${global.APIs}&url=${text}`)
    if (!res.ok) throw `Invalid Spotify url / terjadi kesalahan.`
    let json = await res.json()
    if (json.status != '200') throw `Terjadi kesalahan, coba lagi nanti.`
	let get_result = json.result
	let ini_txt = `Found : ${text}\n\n`
	ini_txt += `Title : *${get_result.title}*\n`
	ini_txt += `Artists : ${get_result.artists}\n`
	ini_txt += `Duration : ${get_result.duration}\n`
	ini_txt += `Popularity : ${get_result.popularity}\n`
	ini_txt += `${get_result.preview_url ? `Preview : ${get_result.preview_url}\n` : ''}`
	await conn.sendFile(m.chat, get_result.thumbnail, 'spot.jpg', ini_txt, m)
	await conn.sendMessage(m.chat, {document: { url: get_result.link }, mimetype: 'audio/mpeg', fileName: `${get_result.artists} - ${get_result.title}.mp3`}, { quoted : m })
}

handler.menudownload = ['spotify <url>']
handler.tagsdownload = ['search']
handler.command = /^spotify$/i

handler.premium = true
handler.limit = true

export default handler





/*import fetch from 'node-fetch'
let handler = async(m, { conn, text }) => {
if (!text) throw `*[â—ğˆğğ…ğâ—] ğ™¸ğ™½ğ™¶ğšğ™´ğš‚ğ™´ ğ™´ğ™» ğ™½ğ™¾ğ™¼ğ™±ğšğ™´ ğ™³ğ™´ ğ™°ğ™»ğ™¶ğš„ğ™½ğ™° ğ™²ğ™°ğ™½ğ™²ğ™¸ğ™¾ğ™½ ğ™° ğ™±ğš„ğš‚ğ™²ğ™°ğš*`
try {
let res = await fetch(`https://api.lolhuman.xyz/api/spotifysearch?apikey=${lolkeysapi}&query=${text}`)
let json = await res.json()
let { link } = json.result[0]
let res2 = await fetch(`https://api.lolhuman.xyz/api/spotify?apikey=${lolkeysapi}&url=${link}`)
let json2 = await res2.json()
let { thumbnail, title, artists, preview_url } = json2.result
let spotifyi = `â’â•â•â•â•â•â¬ ğ’ğğğ“ğˆğ…ğ˜ â­â•â•â•â•â•â•¾â’\nâ”¬\nâ”œâ€£âœ¨ *ğšƒğ™¸ğšƒğš„ğ™»ğ™¾:* ${title}\nâ”´\nâ”¬\nâ”œâ€£ğŸ—£ï¸ *ğ™°ğšğšƒğ™¸ğš‚ğšƒğ™°:* ${artists}\nâ”´\nâ”¬\nâ”œâ€£ğŸŒ *ğš„ğšğ™»*: ${link}\nâ”´\nâ”¬\nâ”œâ€£ğŸ’š *ğš„ğšğ™» ğ™³ğ™´ ğ™³ğ™´ğš‚ğ™²ğ™°ğšğ™¶ğ™°:* ${preview_url}\nâ”´`
conn.sendFile(m.chat, thumbnail, 'error.jpg', spotifyi, m)
await conn.sendFile(m.chat, preview_url, 'error.mp3', null, m, false, { mimetype: 'audio/mp4' }) 
} catch (e) {
throw '*[â—ğˆğğ…ğâ—] ğ™´ğšğšğ™¾ğš, ğ™½ğ™¾ ğš‚ğ™´ ğ™»ğ™¾ğ™¶ğšğ™¾ ğ™±ğš„ğš‚ğ™²ğ™°ğš ğ™»ğ™° ğ™²ğ™°ğ™½ğ™²ğ™¸ğ™¾ğ™½ ğ™¾ ğ™»ğ™° ğ™¿ğ™°ğ™¶ğ™¸ğ™½ğ™° ğ™³ğ™´ ğ™°ğšˆğš„ğ™³ğ™° ğ™¿ğ™°ğšğ™° ğ™±ğš„ğš‚ğ™²ğ™°ğš ğ™»ğ™° ğ™²ğ™°ğ™½ğ™²ğ™¸ğ™¾ğ™½ ğ™´ğš‚ğšƒğ™° ğ™²ğ™°ğ™¸ğ™³ğ™°, ğ™¿ğ™¾ğš ğ™µğ™°ğš…ğ™¾ğš ğš…ğš„ğ™´ğ™»ğš…ğ™° ğ™° ğ™¸ğ™½ğšƒğ™´ğšğ™½ğšƒğ™°ğšğ™»ğ™¾ ğ™¼ğ™°ğš‚ ğšƒğ™°ğšğ™³ğ™´*'
}}
handler.command = /^(spotify|music)$/i
export default handler*/
